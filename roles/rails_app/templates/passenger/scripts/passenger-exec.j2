#!/usr/bin/env bash

# AUTOGENERATED BY ANSIBLE
# NOT CHECKED INTO SOURCE CONTROL

INSTANCES_COUNT={{ passenger_instance_register_dirs.results | count }}

if [[ -z "$ID" ]]; then
  echo "ERROR: MISSING ID= ENV VAR"
  exit 1
elif [[ "$ID" -gt $INSTANCES_COUNT ]] || [[ "$ID" -lt 1 ]]; then
  echo "ERROR: $ID NOT WITHIN THE RANGE OF [1..${INSTANCES_COUNT}]."
  exit 1
fi

export PASSENGER_INSTANCE_REGISTRY_DIR={{ rails_app_shared_run_server_path }}/reg.${ID}.r{{ rails_app_current_release_id }}
export PASSENGER_SOCKET={{ rails_app_shared_run_path }}/{{ rails_app_name }}.${ID}.r{{ rails_app_current_release_id }}.socket
export PASSENGER_SOCKET_FILE={{ rails_app_shared_run_path }}/{{ rails_app_name }}.${ID}.r{{ rails_app_current_release_id }}.socket
export PASSENGER_PID={{ rails_app_shared_run_path }}/{{ rails_app_name }}.${ID}.r{{ rails_app_current_release_id }}.pid
export PASSENGER_PID_FILE={{ rails_app_shared_run_path }}/{{ rails_app_name }}.${ID}.r{{ rails_app_current_release_id }}.pid

set -x

{{ rails_app_current_release_path }}/bin/"$@"
